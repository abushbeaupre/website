[
  {
    "objectID": "case_study.html",
    "href": "case_study.html",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "",
    "text": "Here, we display how to use the visualization method of indirect effects using a real-world example from Coroller-Chouraki et al. (2026) LINK. While the authors examined the effects of several putative causes of the abundance of Protocalliphora spp. in the nests of Tree Swallows breeding along a gradient of agricultural intensity, they focused on direct effects and neglected to formally quantify or visualize hypothesized indirect effects. Here, we apply our novel visualization procedure to two indirect effects linked to the reproductive timing of swallows and included in the DAG on which the aforementioned study was based. More details about the hypothesized causal links in the system and theoretical explanations for the indirect effects visualized here can be found in Coroller-Chouraki et al. (2026) and Bush-Beaupré et al. (2026) LINK.\nThe data for the case study can be downloaded here"
  },
  {
    "objectID": "case_study.html#load-packages",
    "href": "case_study.html#load-packages",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Load packages",
    "text": "Load packages\n\nlibrary(tidyverse)       # data manipulation and plotting\nlibrary(readxl)          # read excel files\nlibrary(glmmTMB)         # frequentist GLMMs\nlibrary(marginaleffects) # marginal predictions\nlibrary(patchwork)       # multiple plots\nlibrary(mgcv)            # GAMMs"
  },
  {
    "objectID": "case_study.html#dag-plotting-function",
    "href": "case_study.html#dag-plotting-function",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "DAG plotting function",
    "text": "DAG plotting function\n\n#' Create a DAG plot with rounded boxes and arrows\n#'\n#' @param labels Character vector of length 3 with names for Exposure, Mediator, Outcome\n#' @param arrow_labels Character vector of length 4 with labels for paths B, C, D, E (default: c(\"B\", \"C\", \"D\", \"E\"))\n#' @param box_colors Character vector of length 3 with hex colors for boxes (default: c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"))\n#' @param arrow_color Color for arrows (default: \"#0F6670\")\n#' @return A ggplot object\ncreate_dag_plot &lt;- function(labels = c(\"Exposure\", \"Mediator\", \"Outcome\"),\n                           arrow_labels = c(\"B\", \"C\", \"D\", \"E\"),\n                           box_colors = c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"),\n                           arrow_color = \"#0F6670\") {\n  \n  # Path diagram (DAG) — rounded boxes + arrows\n  # boxes: name, center x/y, width, height, border colour\n  # Using wider coordinate system (0-1.4 for x) to create rectangular plot\n  boxes &lt;- data.frame(\n    name = labels,\n    x = c(0.7, 0.25, 1.15),\n    y = c(0.8, 0.4, 0.4),\n    width = c(0.7, 0.6, 0.6),\n    height = c(0.14, 0.18, 0.18),\n    col = box_colors,\n    stringsAsFactors = FALSE\n  )\n  \n  # arrow head style\n  arr_closed &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"closed\")\n  arr_open &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"open\")\n  \n  # Draw arrows FIRST so they appear behind boxes\n  p &lt;- ggplot() + xlim(0.2, 1.4) + ylim(0.2, 0.9) + \n    # B: Exposure -&gt; Outcome (right, curved)\n    geom_curve(aes(x = 0.81, y = 0.74, xend = 1.15, yend = 0.5), \n               curvature = -0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # C: Exposure -&gt; Mediator (left, curved)\n    geom_curve(aes(x = 0.59, y = 0.74, xend = 0.25, yend = 0.5), \n               curvature = 0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # D: Mediator -&gt; Outcome (bottom, long curve)\n    geom_curve(aes(x = 0.25, y = 0.31, xend = 1.15, yend = 0.3), \n               curvature = 0.32, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # E: dashed indirect (Exposure -&gt; Outcome via dashed curved line)\n    geom_curve(aes(x = 0.62, y = 0.765, xend = 0.84, yend = 0.41), \n               curvature = 1.5, color = \"slategray3\", size = 1.2,  arrow = arr_closed)\n  \n  # Now draw boxes on top of arrows\n  for(i in seq_len(nrow(boxes))){\n    bx &lt;- boxes[i,]\n    xmin &lt;- bx$x - bx$width/2\n    xmax &lt;- bx$x + bx$width/2\n    ymin &lt;- bx$y - bx$height/2\n    ymax &lt;- bx$y + bx$height/2\n    \n    # draw a rounded rectangle as a grob and place it with annotation_custom\n    rr &lt;- grid::roundrectGrob(r = unit(0.2, \"snpc\"),\n            gp = grid::gpar(fill = \"white\", col = bx$col, lwd = 6))\n    p &lt;- p + annotation_custom(rr, xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax) +\n      annotate(\"text\", x = bx$x, y = bx$y, label = bx$name, \n               fontface = \"bold\", size = 5.5, colour = bx$col)\n  }\n  \n  # Add labels for arrows on top\n  p &lt;- p +\n    annotate(\"text\", x = 1.00, y = 0.62, label = arrow_labels[1], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.40, y = 0.62, label = arrow_labels[2], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.70, y = 0.27, label = arrow_labels[3], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.2, y = 0.7, label = arrow_labels[4], size = 6, fontface = \"bold\") +\n    coord_cartesian(clip = \"off\") +\n    theme_void()\n  \n  return(p)\n}"
  },
  {
    "objectID": "case_study.html#data",
    "href": "case_study.html#data",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Data",
    "text": "Data\n\ndata_protos &lt;- read_excel(\"data_indirecteffects.xlsx\") %&gt;% \n  # scale the data (except comp1 comp2 as it was already centered between 0)\n  mutate( scl_cumulated_chicks = as.vector(scale(cumulated_chicks)),\n          scl_a1j1_p = as.vector(scale(a1j1_p)),\n          scl_a1j1_t = as.vector(scale(a1j1_t)),\n          scl_mean_t_protos = as.vector(scale(mean_t_protos)),\n          scl_mean_p_protos = as.vector(scale(mean_p_protos)),\n          scl_mean_t_bird = as.vector(scale(mean_t_bird)),\n          scl_mean_p_bird = as.vector(scale(mean_p_bird)),\n          scl_timing_clutch = as.vector(scale(timing_clutch)),\n          year = as.factor(year), \n          farm = as.factor(farm),\n          agemom = as.factor(agemom)) \n\nglimpse(data_protos)\n\nRows: 1,175\nColumns: 24\n$ idcouvee             &lt;dbl&gt; 6072049, 6072067, 6252031, 6312061, 6312097, 6432…\n$ farm                 &lt;fct&gt; 339, 339, 339, 339, 339, 339, 339, 339, 339, 339,…\n$ nichoir              &lt;dbl&gt; 20, 20, 29, 32, 32, 38, 41, 44, 44, 47, 47, 20, 2…\n$ year                 &lt;fct&gt; 2008, 2011, 2005, 2010, 2016, 2004, 2006, 2005, 2…\n$ mean_t_protos        &lt;dbl&gt; 19.21152, 19.99097, 21.56581, 17.86704, 21.44941,…\n$ mean_p_protos        &lt;dbl&gt; 4.412069, 3.313214, 3.259667, 4.749355, 2.857241,…\n$ mean_t_bird          &lt;dbl&gt; 18.95252, 19.44646, 20.88006, 17.77005, 21.32746,…\n$ mean_p_bird          &lt;dbl&gt; 3.886667, 3.565500, 3.312273, 4.907391, 3.408095,…\n$ a1j1_p               &lt;dbl&gt; 149.65, 277.90, 199.09, 150.80, 147.43, 206.36, 2…\n$ a1j1_t               &lt;dbl&gt; 556.945, 573.965, 520.830, 710.695, 477.120, 519.…\n$ timing_clutch        &lt;dbl&gt; 154, 166, 171, 154, 185, 171, 154, 154, 159, 190,…\n$ cumulated_chicks     &lt;dbl&gt; 126, 92, 87, 149, 69, 84, 88, 110, 92, 88, 110, 1…\n$ n_protos             &lt;dbl&gt; 31, 29, 1, 9, 2, 1, 5, 8, 25, 12, 2, 9, 70, 35, 6…\n$ comp1                &lt;dbl&gt; 1.7136893, 2.4615953, 1.9719222, 2.6452952, 2.648…\n$ comp2                &lt;dbl&gt; -0.39773502, 0.08269011, -0.51961803, 1.70980123,…\n$ agemom               &lt;fct&gt; ASY, SY, ASY, ASY, SY, ASY, ASY, ASY, ASY, ASY, A…\n$ scl_cumulated_chicks &lt;dbl&gt; 0.76339770, -0.26769764, -0.41932931, 1.46090337,…\n$ scl_a1j1_p           &lt;dbl&gt; -1.10439407, 1.79796415, 0.01445654, -1.07836902,…\n$ scl_a1j1_t           &lt;dbl&gt; 0.9545618, 1.2213581, 0.3884427, 3.3646632, -0.29…\n$ scl_mean_t_protos    &lt;dbl&gt; 0.72057902, 1.30824321, 2.49559694, -0.29309542, …\n$ scl_mean_p_protos    &lt;dbl&gt; 0.3450492, -0.5928678, -0.6385729, 0.6329363, -0.…\n$ scl_mean_t_bird      &lt;dbl&gt; 0.76920191, 1.10353351, 2.07389174, -0.03117221, …\n$ scl_mean_p_bird      &lt;dbl&gt; -0.005763027, -0.222595172, -0.393558782, 0.68336…\n$ scl_timing_clutch    &lt;dbl&gt; -1.023968550, 0.726086790, 1.455276515, -1.023968…\n\n\n\nMetadata\nidcouvee — Unique identifier for each clutch (nesting attempt). [anonymized]\nfarm — Farm or study site where the nest box is located. [anonymized]\nnichoir — Nest box identifier within a given farm. [anonymized]\nyear — Year in which the breeding attempt occurred.\nn_protos — Number of Protocalliphora spp. puparia (pupal cases) found in the nest at the end of the breeding season; used as a proxy of ectoparasite abundance.\ncumulated_chicks — Proxy for host availability for Protocalliphora larvae, calculated as the number of chicks multiplied by the number of days they remained in the nest.\nmean_t_bird — Mean air temperature (°C) during the period corresponding to the nestling stage of the host chicks. (From hatching to fledging or demise)\nmean_p_bird — Mean precipitation (mm) during the period corresponding to the nestling stage of the host chicks. (From hatching to fledging or demise)\nmean_t_protos — Mean air temperature (°C) during the time window relevant for Protocalliphora larvae development (the same window as for chicks +7 days).\nmean_p_protos — Mean precipitation (mm) during the time window relevant for Protocalliphora larvae development (the same window as for chicks +7 days).\na1j1_t — Cumulative sum of hourly degrees above 5 °C between April 1 and June 1 (thermal accumulation, proxy for early-season temperature conditions).\na1j1_p — Cumulative sum of hourly precipitation between April 1 and June 1 (proxy for early-season moisture conditions).\ntiming_clutch — Day of the year corresponding to the hatching date of the first chick in the clutch (proxy for breeding phenology).\ncomp1 — First component from the rPCA describing agricultural landscape composition. Positively correlated with maize and soybean cover. Negatively correlated with forage and tree cover. Explains ~79% of the variance in habitat composition.\ncomp2 — Second component from the rPCA describing agricultural landscape composition. Positively correlated with tree cover. Negatively correlated with forage cover. Explains ~17% of the variance in habitat composition.\nagemom — Age class of the Tree Swallow mother for the given clutch (2nd year = young adult; After 2nd year = older adult)."
  },
  {
    "objectID": "case_study.html#dag",
    "href": "case_study.html#dag",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "DAG",
    "text": "DAG\n\n\nCode\nDAG_2 &lt;- create_dag_plot(\n  labels = c(\"Hatching date\", \"Nestling-days\", \"Abundance\")\n) +\n  xlim(0.05, 1.4) +\n  theme(plot.margin = margin(t = 10, r = 10, b = 10, l = 10, unit = \"pt\"))\n  \nprint(DAG_2)"
  },
  {
    "objectID": "case_study.html#models",
    "href": "case_study.html#models",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Models",
    "text": "Models\n\nNestling-days ~ Hatching date (Mediator ~ Exposure)\n\nm_host &lt;- gam(data = data_protos, \n             formula = cumulated_chicks ~ \n                    s(year, bs = \"re\") + s(farm, by = year, bs = \"re\") + \n                    scl_a1j1_p + scl_a1j1_t + \n                   agemom +\n                 s(scl_timing_clutch) +                          \n                te(comp1, comp2)  + te(scl_mean_t_bird, scl_mean_p_bird), \n             family = gaussian(link = \"log\"), method =  \"REML\")\n\n\nPredictions\nWe need to unscale hatching date after generating the predictions for the prediction plot.\n\n# population effect prediction\np_hatchdate_nestdays &lt;- predictions(m_host, \n                            newdata = datagrid(scl_timing_clutch = \n                                               seq(from = min(data_protos$scl_timing_clutch), \n                                                   to = max(data_protos$scl_timing_clutch), \n                                                   by = 0.1)), \n                            exclude = c(\"s(farm)\",\"s(year)\")) \n\n# we obtained predictions, but need to unscale the explanatory variable \"timing_clutch\" \np_hatchdate_nestdays &lt;- p_hatchdate_nestdays %&gt;%  \n  mutate(hatch_date = scl_timing_clutch * sd(data_protos$timing_clutch) + mean(data_protos$timing_clutch)) %&gt;% \n  select(-c(year,farm))\n\n\n\nPrediction plot\n\nplot_hatchdate_nestdays &lt;- ggplot(data = p_hatchdate_nestdays, aes(x = hatch_date , y = estimate)) + \n  geom_ribbon(aes(ymax = conf.high , ymin = conf.low),alpha = 0.05)+  \n  geom_line( linewidth = 1.5, lineend = \"round\") + \n  geom_segment(y= min(p_hatchdate_nestdays$estimate),\n                                   x = 0, xend= max(p_hatchdate_nestdays$hatch_date), linetype= \"dashed\") +\n  geom_segment(y=max(p_hatchdate_nestdays$estimate), x = 0, xend= min(p_hatchdate_nestdays$hatch_date), linetype= \"dashed\") +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Nestling-days\", x = \"Hatching date\") +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.line.x = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\", size = 14)) +   \n  scale_y_continuous(breaks = seq(80, 120, by = 20)) +\n  scale_x_continuous(breaks = seq(140, 190, by = 15))+\n  coord_cartesian(xlim = c(140, 195))\n\nplot_hatchdate_nestdays\n\n\n\n\n\n\n\n\n\n\n\nProtocalliphora abundance ~ Hatching date + nestling-days (Outcome ~ Exposure + Mediator)\n\nm_protos &lt;- gam(data = data_protos, formula = n_protos ~ \n                    s(year, bs = \"re\") + s(farm, by = year, bs = \"re\") + \n                   scl_a1j1_t + scl_a1j1_p + \n                  s(scl_timing_clutch) + scl_cumulated_chicks + \n                 te(comp1,comp2) + te(scl_mean_t_protos, scl_mean_p_protos),\n              family = tw(link = \"log\"), method = \"REML\")\n\n\nProtocalliphora abundance ~ Hatching date (Outcome ~ Exposure)\n\nPredictions\n\np_hatchdate_protos &lt;- predictions(m_protos, newdata = \n                             datagrid(scl_timing_clutch = \n                                               seq(from = min(data_protos$scl_timing_clutch), \n                                                   to = max(data_protos$scl_timing_clutch), \n                                                   by = 0.1)), \n                             exclude = c(\"s(farm)\",\"s(year)\")) #population effect prediction\n\n#we got the predictions, but need to unscale the explanatory variable \"timing_clutch\"\np_hatchdate_protos &lt;- p_hatchdate_protos %&gt;%  \n  mutate(hatch_date = scl_timing_clutch * sd(data_protos$timing_clutch) + mean(data_protos$timing_clutch)) %&gt;% \n  select(-c(year,farm))\n\n\n\nPrediction plot\n\nplot_hatchdate_proto &lt;- ggplot(data = p_hatchdate_protos, aes(x = hatch_date , y = estimate)) + \n  geom_ribbon(aes(ymax = conf.high , ymin = conf.low),alpha = 0.05)+  \n  geom_line( linewidth = 1.5, lineend = \"round\") +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Abundance\", x = \"Hatching date\") +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\",  size = 14)) +\n  scale_y_continuous(breaks = seq(5,20, by = 5)) +\n  scale_x_continuous(breaks = seq(140, 190, by = 15)) +\n  coord_cartesian(xlim = c(140, 195))\n\n\nplot_hatchdate_proto\n\n\n\n\n\n\n\n\n\n\n\nProtocalliphora abundance ~ Nestling-days (Outcome ~ Mediator)\n\nPredictions\n\np_nestdays_protos &lt;- predictions(m_protos, newdata = \n                             datagrid(scl_cumulated_chicks = seq(from = min(data_protos$scl_cumulated_chicks), to = max(data_protos$scl_cumulated_chicks), by = 0.1)), exclude = c(\"s(farm)\",\"s(year)\")) #population effect prediction\n\n#we got the predictions, but need to unscale the explanatory variable \"cumulated_chics\" (=host availability)\np_nestdays_protos &lt;- p_nestdays_protos %&gt;%  \n  mutate(cumulated_chicks = scl_cumulated_chicks * sd(data_protos$cumulated_chicks) + mean(data_protos$cumulated_chicks)) %&gt;% select(-c(year, farm))\n\n\n\nPrediction plot\n\nplot_nestdays_protos &lt;- ggplot(data = p_nestdays_protos, aes(y = estimate, x = cumulated_chicks)) +\n  geom_line(linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.05) +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Abundance\", x = \"Nestling-days\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\",  size = 14))+ \n    scale_y_continuous(breaks = seq(10,50, by = 20))+\n    scale_x_continuous(breaks = seq(25,175, by = 50))\n\nplot_nestdays_protos"
  },
  {
    "objectID": "case_study.html#indirect-effect",
    "href": "case_study.html#indirect-effect",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Indirect effect",
    "text": "Indirect effect\n\nPredictions\nWe need the nestling-days values as predicted by hatching date to predict the values of Protocalliphora abundance along that predicted range. Since nestling-days are scaled in the model, we need to scale the predicted values using the original dataset, obtain the predicted Protocalliphora values and convert back to the original scale.\n\np_ind_hatchdate_protos &lt;- predictions(m_protos, \n                         newdata = datagrid(\n                           scl_cumulated_chicks = (p_hatchdate_nestdays$estimate - mean(data_protos$cumulated_chicks)) / sd(data_protos$cumulated_chicks)), \n                         exclude = c(\"s(farm)\",\"s(year)\")) %&gt;%\n  # unscale cumulated chicks                       \n  mutate(cumulated_chicks = scl_cumulated_chicks*sd(data_protos$cumulated_chicks) + mean(data_protos$cumulated_chicks)) %&gt;% \n  # Add unscaled hatch_date from the prediction grid\n  left_join(p_hatchdate_nestdays |&gt; \n               select(estimate, hatch_date) |&gt;\n               rename(cumulated_chicks = estimate)) \n\nJoining with `by = join_by(cumulated_chicks)`\n\n\n\n\nPrediction plot\n\nCOLS &lt;- alpha(colorRampPalette(c(\"seashell\",\"tomato3\"))(30),0.8)\n\nplot_ind_hatchdate_protos &lt;- plot_nestdays_protos + \n  geom_line(data = p_ind_hatchdate_protos, \n            aes(y = estimate, x = cumulated_chicks, color = hatch_date, \n                linewidth = hatch_date), lineend = \"round\") +\n  geom_segment(x=min(p_ind_hatchdate_protos$cumulated_chicks), y=0, yend= min(p_ind_hatchdate_protos$estimate), linetype= \"dashed\") +\n  geom_segment(x=max(p_ind_hatchdate_protos$cumulated_chicks), y=0, yend=max(p_ind_hatchdate_protos$estimate), linetype= \"dashed\") +\n  scale_color_gradientn(colours = COLS, name = \"Hatching date\") +\n  guides(linewidth = \"none\") +\n  theme(legend.position = \"inside\",\n  legend.key.size = unit(1.1, \"cm\"),\n        legend.position.inside = c(0.35, 0.7),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(color = \"tomato4\", size = 12, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title = element_text(color = \"tomato4\",size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title.position = \"top\") +\n  scale_y_continuous(breaks = seq(10,50, by = 20))\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\nplot_ind_hatchdate_protos"
  },
  {
    "objectID": "case_study.html#publication-figure-2",
    "href": "case_study.html#publication-figure-2",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Publication Figure 2",
    "text": "Publication Figure 2\n\n# Create right column with B and C stacked\nright_col_top_2 &lt;- plot_hatchdate_proto /  plot_hatchdate_nestdays\n\n# Create layout: DAG on left, right column on right for rows 1-2\ntop_section_2 &lt;- (DAG_2 | right_col_top_2) + plot_layout(widths = c(1, 1))\n\n# Row 3 has two plots side by side\nrow3_2 &lt;- plot_nestdays_protos + plot_ind_hatchdate_protos + plot_layout(widths = c(0.7, 1))\n\n# Combine all\nfig_2 &lt;- top_section_2 / row3_2 + \n  plot_layout(heights = c(2, 1)) +\n  plot_annotation(tag_levels = 'A') &\n  theme(plot.tag = element_text(size = 16, face = \"bold\"))\n\nfig_2"
  },
  {
    "objectID": "simulations.html",
    "href": "simulations.html",
    "title": "Simulations",
    "section": "",
    "text": "Using simulations, we will explore how to visualize indirect effects when we have an exposure, mediator and outcome variable."
  },
  {
    "objectID": "simulations.html#load-packages",
    "href": "simulations.html#load-packages",
    "title": "Simulations",
    "section": "Load packages",
    "text": "Load packages\n\nlibrary(tidyverse)       # data manipulation and plotting\nlibrary(glmmTMB)         # frequentist GLMMs\nlibrary(patchwork)       # multiple plots\nlibrary(marginaleffects) # marginal predictions\n\nset.seed(333) # set seed to reproduce the simulations exactly"
  },
  {
    "objectID": "simulations.html#dag-plotting-function",
    "href": "simulations.html#dag-plotting-function",
    "title": "Simulations",
    "section": "DAG plotting function",
    "text": "DAG plotting function\n\n#' Create a DAG plot with rounded boxes and arrows\n#'\n#' @param labels Character vector of length 3 with names for Exposure, Mediator, Outcome\n#' @param arrow_labels Character vector of length 4 with labels for paths B, C, D, E (default: c(\"B\", \"C\", \"D\", \"E\"))\n#' @param box_colors Character vector of length 3 with hex colors for boxes (default: c(\"#B22222\", \"#2E8B57\", \"#1E90FF\"))\n#' @param arrow_color Color for arrows (default: \"#0F6670\")\n#' @return A ggplot object\ncreate_dag_plot &lt;- function(labels = c(\"Exposure\", \"Mediator\", \"Outcome\"),\n                           arrow_labels = c(\"B\", \"C\", \"D\", \"E\"),\n                           box_colors = c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"),\n                           arrow_color = \"#0F6670\") {\n  \n  # Path diagram (DAG) — rounded boxes + arrows\n  # boxes: name, center x/y, width, height, border colour\n  # Using wider coordinate system (0-1.4 for x) to create rectangular plot\n  boxes &lt;- data.frame(\n    name = labels,\n    x = c(0.7, 0.25, 1.15),\n    y = c(0.8, 0.4, 0.4),\n    width = c(0.7, 0.6, 0.6),\n    height = c(0.14, 0.18, 0.18),\n    col = box_colors,\n    stringsAsFactors = FALSE\n  )\n  \n  # arrow head style\n  arr_closed &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"closed\")\n  arr_open &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"open\")\n  \n  # Draw arrows FIRST so they appear behind boxes\n  p &lt;- ggplot() + xlim(0.2, 1.4) + ylim(0.2, 0.9) + \n    # B: Exposure -&gt; Outcome (right, curved)\n    geom_curve(aes(x = 0.81, y = 0.74, xend = 1.15, yend = 0.5), \n               curvature = -0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # C: Exposure -&gt; Mediator (left, curved)\n    geom_curve(aes(x = 0.59, y = 0.74, xend = 0.25, yend = 0.5), \n               curvature = 0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # D: Mediator -&gt; Outcome (bottom, long curve)\n    geom_curve(aes(x = 0.25, y = 0.31, xend = 1.15, yend = 0.3), \n               curvature = 0.32, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # E: dashed indirect (Exposure -&gt; Outcome via dashed curved line)\n    geom_curve(aes(x = 0.62, y = 0.765, xend = 0.84, yend = 0.41), \n               curvature = 1.5, color = \"slategray3\", size = 1.2,  arrow = arr_closed)\n  \n  # Now draw boxes on top of arrows\n  for(i in seq_len(nrow(boxes))){\n    bx &lt;- boxes[i,]\n    xmin &lt;- bx$x - bx$width/2\n    xmax &lt;- bx$x + bx$width/2\n    ymin &lt;- bx$y - bx$height/2\n    ymax &lt;- bx$y + bx$height/2\n    \n    # draw a rounded rectangle as a grob and place it with annotation_custom\n    rr &lt;- grid::roundrectGrob(r = unit(0.2, \"snpc\"),\n            gp = grid::gpar(fill = \"white\", col = bx$col, lwd = 6))\n    p &lt;- p + annotation_custom(rr, xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax) +\n      annotate(\"text\", x = bx$x, y = bx$y, label = bx$name, \n               fontface = \"bold\", size = 6, colour = bx$col)\n  }\n  \n  # Add labels for arrows on top\n  p &lt;- p +\n    annotate(\"text\", x = 1.00, y = 0.62, label = arrow_labels[1], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.40, y = 0.62, label = arrow_labels[2], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.70, y = 0.27, label = arrow_labels[3], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.2, y = 0.7, label = arrow_labels[4], size = 6, fontface = \"bold\") +\n    coord_cartesian(clip = \"off\") +\n    theme_void()\n  \n  return(p)\n}"
  },
  {
    "objectID": "simulations.html#data",
    "href": "simulations.html#data",
    "title": "Simulations",
    "section": "Data",
    "text": "Data\n\nn &lt;- 3000 # sample size\nE &lt;- rnorm(n, 0, 1) # define E as a Z-score\nM &lt;- rpois(n, exp(4 + 0.1*E)) # M is a poisson variable whose link is the log function so defining the coefficients using the inverse log (exponential)\nO &lt;- rbinom(n, size = 1, prob = plogis(-3 + 0.1*E + 0.05*M)) # O is a Bernoulli variable whose link is the logit so defining the coefficients using the inverse logit (plogis)\n\ndata &lt;- tibble(\n  E = E,\n  M = M,\n  O = O,\n  O_1 = 1 - O\n)\n\nhead(data)\n\n# A tibble: 6 × 4\n        E     M     O   O_1\n    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;\n1 -0.0828    44     0     1\n2  1.93      71     1     0\n3 -2.05      45     0     1\n4  0.278     58     0     1\n5 -1.53      43     0     1\n6 -0.269     62     0     1"
  },
  {
    "objectID": "simulations.html#models",
    "href": "simulations.html#models",
    "title": "Simulations",
    "section": "Models",
    "text": "Models\nWe need two models: one where we regress the Mediator as a function of the Exposure. A second where we regress the Outcome as a function of both the Mediator and Exposure. ### M ~ E\n\nmM_E &lt;- glmmTMB(M ~ E, family = poisson, data = data)\n\n\nO ~ E + M\n\nmO_EM &lt;- glmmTMB(cbind(O, O_1) ~ E + M, family = binomial, data = data)"
  },
  {
    "objectID": "simulations.html#predictions",
    "href": "simulations.html#predictions",
    "title": "Simulations",
    "section": "Predictions",
    "text": "Predictions\n\nM ~ E\n\npred_M_E &lt;- predictions(mM_E, vcov = TRUE, newdata = datagrid(E = seq(from = min(data$E), to = max(data$E), length.out = 3000))) # need many points for the visualisation of the indirect effect later on\nhead(pred_M_E)\n\n\n     E Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %\n -3.51     38.1      0.352 108   &lt;0.001 Inf  37.4   38.7\n -3.50     38.1      0.352 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 109   &lt;0.001 Inf  37.4   38.8\n\nType: response\n\n\n\nPlot\n\npM_E &lt;- ggplot(data = pred_M_E) +\n  geom_line(aes(y = estimate, x = E), \n            lineend = \"round\",\n            linewidth = 1.5) +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = E), \n              alpha = 0.2) +\n  geom_segment(y=min(pred_M_E$estimate), \n               x = min(pred_M_E$E)*1.3, \n               xend= min(pred_M_E$E), \n               linetype= \"dashed\") +\n  geom_segment(y=max(pred_M_E$estimate), \n               x = min(pred_M_E$E)*1.3, \n               xend= max(pred_M_E$E), \n               linetype= \"dashed\") +\n  scale_y_continuous(breaks = seq(from = 40, to = 80, by = 10))+\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Mediator\",\n       x = \"Exposure\") + \n  coord_cartesian(xlim = c(-4,4)) +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"aquamarine4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(face = \"bold\", \n                                    \n                                   size = 14),\n        plot.title = element_text(size = 16)) \n\npM_E\n\n\n\n\n\n\n\n\n\n\n\nO ~ E + M\n\n\nDirect effect of E\n\npred_O_E &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(E = seq(from = min(data$E), to = max(data$E), length.out = 30)))\nhead(pred_O_E)\n\n\n     E Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 %\n -3.51    0.367     0.0399  9.21   &lt;0.001  64.8 0.289  0.445\n -3.26    0.373     0.0375  9.94   &lt;0.001  75.0 0.299  0.446\n -3.02    0.378     0.0351 10.78   &lt;0.001  87.6 0.309  0.447\n -2.77    0.383     0.0326 11.75   &lt;0.001 103.5 0.319  0.447\n -2.53    0.389     0.0302 12.89   &lt;0.001 123.9 0.330  0.448\n -2.29    0.394     0.0277 14.23   &lt;0.001 150.3 0.340  0.449\n\nType: response\n\n\n\nPlot\n\npO_E &lt;- ggplot(data = pred_O_E) +\n  geom_line(aes(y = estimate, x = E), linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = E), alpha = 0.05) +\n  \n  theme_classic() +\n  labs(title = NULL,\n       y = \"Outcome\",\n       x = \"Exposure\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(\n                                   face = \"bold\", \n                                   size = 14),\n        plot.title = element_text(size = 16))\npO_E \n\n\n\n\n\n\n\n\n\n\n\nDirect effect of M\n\npred_O_M &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(M = seq(from = min(data$M), to = max(data$M), length.out = 30)))\nhead(pred_O_M)\n\n\n    M Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 %\n 27.0    0.174     0.0216  8.06   &lt;0.001  50.3 0.132  0.216\n 29.3    0.191     0.0214  8.92   &lt;0.001  60.8 0.149  0.232\n 31.6    0.208     0.0209  9.94   &lt;0.001  74.9 0.167  0.249\n 33.9    0.227     0.0203 11.18   &lt;0.001  94.0 0.187  0.267\n 36.2    0.247     0.0194 12.72   &lt;0.001 120.7 0.209  0.285\n 38.6    0.268     0.0183 14.64   &lt;0.001 158.8 0.232  0.304\n\nType: response\n\n\n\nPlot\n\npO_M &lt;- ggplot(data = pred_O_M) +\n  geom_line(aes(y = estimate, x = M), linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = M), alpha = 0.05) +\n  \n  theme_classic() +\n  labs(title = NULL,\n       y = \"Outcome\",\n       x = \"Mediator\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"aquamarine4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(\n                                   face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(face = \"bold\", \n                                   size = 14),\n        plot.title = element_text(size = 16))\npO_M\n\n\n\n\n\n\n\n\nSo this is the direct effect of M on O. But, remember that M is caused by E so it may be of interest to see how E affects O indirectly, through M.\n\n\n\nIndirect effect of E\n\npM_E\n\n\n\n\n\n\n\n\nThe next step is actually quite simple. We generate predictions for O as a function of the predictions of M ~ E\n\npred_O_EM &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(M = pred_M_E$estimate))\nhead(pred_O_EM)\n\n\n    M Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.5 0.227  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.6 0.227  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.8 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.0 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.1 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.3 0.228  0.301\n\nType: response\n\n\nNow, we need the values of E that were associated with the predicted values of M\n\npred_O_ME &lt;- pred_O_EM %&gt;%\n  select(-c(E)) %&gt;% #remove E; it's set to its mean as we don't need it\n  mutate(E = pred_M_E$E)\n\nhead(pred_O_ME)\n\n\n Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %\n    0.264     0.0186 14.2   &lt;0.001 149.5 0.227  0.300\n    0.264     0.0186 14.2   &lt;0.001 149.6 0.227  0.300\n    0.264     0.0186 14.2   &lt;0.001 149.8 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.0 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.1 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.3 0.228  0.301\n\n\nNow, we simply superimpose both graphs of O ~ M\n\nPlot\n\nCOLS &lt;- alpha(colorRampPalette(c(\"seashell\",\"tomato3\"))(30),0.8)\n\npO_ME &lt;- pO_M + geom_line(data = pred_O_ME, aes(x = M, y = estimate, color = E, linewidth = E), lineend = \"round\") +\n  geom_segment(x=min(pred_O_ME$M), y = 0, yend= min(pred_O_ME$estimate), linetype= \"dashed\") +\n  geom_segment(x=max(pred_O_ME$M), y = 0, yend= max(pred_O_ME$estimate), linetype= \"dashed\") +\n  labs(title = NULL) + \n  scale_color_gradientn(colours = COLS, name = \"Exposure\") +\n  guides(linewidth = \"none\") +\n  theme(legend.position = \"inside\",\n        legend.position.inside = c(0.3, 0.75),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(color = \"tomato4\", size = 12, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title = element_text(color = \"tomato4\",size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title.position = \"top\")\n\npO_ME"
  },
  {
    "objectID": "simulations.html#figure-for-publication",
    "href": "simulations.html#figure-for-publication",
    "title": "Simulations",
    "section": "Figure for publication",
    "text": "Figure for publication\n\n# Create right column with B and C stacked\nright_col_top &lt;- pO_E / pM_E\n\n# Create layout: DAG on left, right column on right for rows 1-2\ntop_section &lt;- (DAG_default | right_col_top) + plot_layout(widths = c(1, 1))\n\n# Row 3 has two plots side by side\nrow3 &lt;- pO_M + pO_ME + plot_layout(widths = c(0.7, 1))\n\n# Combine all\nfig_1 &lt;- top_section / row3 + \n  plot_layout(heights = c(2, 1)) +\n  plot_annotation(tag_levels = 'A') &\n  theme(plot.tag = element_text(size = 16, face = \"bold\"))\n\nfig_1"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Extending the causal inference toolkit for ecologists: A visualization method of indirect effects",
    "section": "",
    "text": "Allen Bush-Beaupré1, Simon Coroller-Chouraki1, Marc Bélisle1,2\n1Université de Sherbrooke, Département de biologie, Sherbrooke, Canada\n2Centre d’étude de la forêt (CÉF)\nAllen Bush-Beaupré: allen.bush-beaupre@usherbrooke.ca | ORCID: 0000-0001-6989-9278\nSimon Coroller-Chouraki: ORCID: 0000-0001-8721-3727\nMarc Bélisle: ORCID: 0000-0003-0657-6724\n\nWelcome to the webpage dedicated to visualizing indirect effects for a wide scope of use cases in causal and network analyses. Being ecologists, we have focused on applying the visualization method we developed to examples in ecology. The method can however be applied to all fields of research in which indirect effects are of interest. By leveraging commonly used software such as marginaleffects and ggplot2, our method can be easily integrated into most analysis workflows.\n\n\n\n\nFigure 1.(A) Directed acyclic graph of a simulated example of the direct effect of an exposure variable on an outcome variable and its indirect effect through a mediator. (B) Prediction of the direct effect of the exposure on the outcome. (C) Prediction of the direct effect of the exposure on the mediator. (D) Prediction of the direct effect of the mediator on the outcome. (E) Prediction of the indirect effect of the exposure on the outcome superimposed on the prediction of the direct effect of the mediator on the outcome.\n\n\n\nAbstract\nMuch ecological research focuses on how a given variable can affect another either directly or indirectly through the effect of one or more intervening variables in the context of causal inference and network analyses. Various methods to quantify the magnitude of these effects are available but are difficult to interpret in a meaningful way. We propose a method of visualizing indirect effects by means of plotting model predictions of an outcome in the presence of exposure and mediator variables. We demonstrate the method through simulations and apply them to a real-world example involving Tree Swallows (Tachycineta bicolor) and their obligatory hematophagous ectoparasites, Protocalliphora spp. bird blowflies. The simple procedure using commonplace software should prove instrumental to visualize and interpret relationships among variables involved in ecological mechanisms and can be seamlessly integrated to analysts’ workflows.\n\nThis is the link towards the preprint of our article describing the method on Biorxiv.\nThis is the link to access and download the data used in the case study.\n\n\n\nWe use simulations to display the method with a simple use case in the Simulations tab. In the Case Study tab, we show how to use the visualization method in the case of real world data and models in which the predictor variables have been scaled. This adds a subtle layer of complexity to the procedure but the code should help overcome this."
  }
]